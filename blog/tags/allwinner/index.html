<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">2 篇博文 含有标签「Allwinner」 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dshanpi.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://dshanpi.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://dshanpi.100ask.net/blog/tags/allwinner"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="2 篇博文 含有标签「Allwinner」 | 东山Π"><meta data-rh="true" name="description" content="Allwinner tag description"><meta data-rh="true" property="og:description" content="Allwinner tag description"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://dshanpi.100ask.net/blog/tags/allwinner"><link data-rh="true" rel="alternate" href="https://dshanpi.100ask.net/blog/tags/allwinner" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://dshanpi.100ask.net/en/blog/tags/allwinner" hreflang="en"><link data-rh="true" rel="alternate" href="https://dshanpi.100ask.net/blog/tags/allwinner" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="东山Π RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="东山Π Atom Feed"><link rel="stylesheet" href="/assets/css/styles.f12ff3da.css">
<script src="/assets/js/runtime~main.b8f9ead6.js" defer="defer"></script>
<script src="/assets/js/main.29502e3a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="https://dshanpi.100ask.org/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a class="navbar__item navbar__link" href="/docs/T113x/intro">T113x</a><a class="navbar__item navbar__link" href="/docs/D1-Nezha/D1h-DualDisplay/BoardIntroduction">D1-Nezha</a><a class="navbar__item navbar__link" href="/docs/A133-mCore/BoardIntroduction">A133-mCore</a><a class="navbar__item navbar__link" href="/docs/T527-AvaotaA1/BoardIntroduction">T527-AvaotaA1</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/blog/tags/allwinner" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/blog/tags/allwinner" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/linuxboard-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/T113异构介绍">T113x系列异构简介</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/welcome">Welcome</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>2 篇博文 含有标签「Allwinner」</h1><p>Allwinner tag description</p><a href="/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/T113异构介绍">T113x系列异构简介</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-11-06T00:00:00.000Z">2025年11月6日</time> · <!-- -->阅读需 17 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/yuxuan"><img class="avatar__photo authorImage_XqGP" src="https://dshanpi.100ask.org/img/logo.svg" alt="世玉轩"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/yuxuan"><span class="authorName_yefp" translate="no">世玉轩</span></a></div><small class="authorTitle_nd0D" title="100askTeam yuxuan.">100askTeam yuxuan.</small><div class="authorSocials_rSDt"><a href="https://x.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/codebug8" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/all-sebastien-lorber-articles"><img class="avatar__photo authorImage_XqGP" src="https://dshanpi.100ask.org/img/logo.svg" alt="韦东山"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/all-sebastien-lorber-articles"><span class="authorName_yefp" translate="no">韦东山</span></a></div><small class="authorTitle_nd0D" title="100askTeam maintainer">100askTeam maintainer</small><div class="authorSocials_rSDt"><a href="https://github.com/weidongshan" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"><p>T113s4芯片包含四个CPU。两个主核心Arm A7 CPU，运行Tina Linux（全志自研Linux）系统，为芯片主系统；</p>
<p>一个是RISC-V C906辅助CPU，运行RTOS（全志自研RTOS）系统，主要功能是提供通用算力补充、实现实时控制、辅助 Linux 实现快起和低功耗管理等功能。</p>
<p>还有一个是 DSP HIFI4 核心，主要是用来处理音频算法部分，因为这部分编译器需要企业单独申请，所以无法进行开发使用。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="t113家族">T113家族<a href="#t113家族" class="hash-link" aria-label="T113家族的直接链接" title="T113家族的直接链接" translate="no">​</a></h2>
<blockquote>
<p>如下内容摘自 T113x_Datasheet_V1.3.pdf 版本</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="image-20240909151235761" src="/assets/images/image-20240909151235761-6173a3b5d070b7c60235c9fa450a6f3f.png" width="2580" height="782" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="t113芯片框图">T113芯片框图<a href="#t113芯片框图" class="hash-link" aria-label="T113芯片框图的直接链接" title="T113芯片框图的直接链接" translate="no">​</a></h2>
<p><img decoding="async" loading="lazy" alt="image-20240909151155233" src="/assets/images/image-20240909151155233-ece3f35e6be361bcd9ed43f6a61ebda7.png" width="1625" height="1338" class="img_ev3q"></p>
<p>简单描述</p>
<p><img decoding="async" loading="lazy" alt="image-20240909151332822" src="/assets/images/image-20240909151332822-4f4532c5a759a0a6f1e29002406491c4.png" width="2448" height="1196" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="异构子系统框架">异构子系统框架<a href="#异构子系统框架" class="hash-link" aria-label="异构子系统框架的直接链接" title="异构子系统框架的直接链接" translate="no">​</a></h2>
<blockquote>
<p>参阅 T113x_User_Manual_V1.2.pdf</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="image-20240909152022940" src="/assets/images/image-20240909152022940-c95ee03d001d24f1c447cb637d93eb77.png" width="1985" height="1425" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="image-20240909151608100" src="/assets/images/image-20240909151608100-1dce711208f270c4f103409b27e202d9.png" width="1823" height="1745" class="img_ev3q"></p>
<p>相关内存分布</p>
<p><img decoding="async" loading="lazy" alt="image-20240909153500017" src="/assets/images/image-20240909153500017-ab17a40034bd42c3b68c9f3f9413f0fc.png" width="1910" height="1362" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgbox-与amp-rpmsg">MSGBOX 与AMP RPMSG<a href="#msgbox-与amp-rpmsg" class="hash-link" aria-label="MSGBOX 与AMP RPMSG的直接链接" title="MSGBOX 与AMP RPMSG的直接链接" translate="no">​</a></h2>
<p>在 Tina Linux 中，提供 AMP 与 RPMsg 对接 C906</p>
<ol>
<li>Linux remoteproc 管理控制 C907</li>
<li>RPMsg 与 C907 通讯</li>
</ol>
<p>T113 的异构系统通讯在硬件上使用的是 MSGBOX，在软件层面上使用的是 AMP 与 RPMsg 通讯协议。其中 A7 上基于 Linux 标准的 RPMsg 驱动框架，C906基于 OpenAMP 异构通信框架。</p>
<p>T113 所带有的 A7 主核心与 C906 辅助核心是完全不同的两个核心，为了最大限度的发挥他们的性能，协同完成某一任务，所以在不同的核心上面运行的系统也各不相同。这些不同架构的核心以及他们上面所运行的软件组合在一起，就成了 AMP 系统 （Asymmetric Multiprocessing System, 异构多处理系统）。</p>
<p>由于两个核心存在的目的是协同的处理，因此在异构多处理系统中往往会形成 Master - Remote 结构。主核心启动后启动从核心。当两个核心上的系统都启动完成后，他们之间就通过 IPC（Inter Processor Communication）方式进行通信，而 RPMsg 就是 IPC 中的一种。</p>
<p>在AMP系统中，两个核心通过共享内存的方式进行通信。两个核心通过 AMP 中断来传递讯息。内存的管理由主核负责。</p>
<p><img decoding="async" loading="lazy" alt="image-20220704155816774" src="/assets/images/image-20220704155816774-3b1f87eaec75897abc2ec68d8241b394-3b1f87eaec75897abc2ec68d8241b394.png" width="670" height="332" class="img_ev3q"></p>
<p>AMP 系统在每个通信方向上都有两个缓冲区，分别是 <code>USED</code> 和 <code>AVAIL</code>，这个缓冲区可以按照 RPMsg 中消息的格式分成一块一块链接形成一个环。</p>
<p><img decoding="async" loading="lazy" alt="image-20220704160952936" src="/assets/images/image-20220704160952936-d935d39ac5331928866997e523ba653d.png" width="372" height="482" class="img_ev3q"></p>
<p>当主核需要和从核进行通信的时候可以分为四步：</p>
<p>（1）主核先从USED中取得一块内存（Allocate）</p>
<p>（2）将消息按照消息协议填充</p>
<p>（3）将该内存链接到 AVAIL 缓冲区中（Send）</p>
<p>（4）触发中断，通知辅助核有消息处理</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2958689-e0da20bb240ff26d-99bdcc4e062f081332514baa9cb7819f.png" width="869" height="436" class="img_ev3q"></p>
<p>反之，从核需要和主核通信的时候也类似：</p>
<p>（1）从核先从AVAIL中取得一块内存（Allocate）</p>
<p>（2）将消息按照消息协议填充</p>
<p>（3）将该内存链接到 USED 缓冲区中（Send）</p>
<p>（4）触发中断，通知主核有消息处理。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2958689-9430112ac1bc82dd-756bb98ee2c2def8cbd55209c5ba045b.png" width="889" height="444" class="img_ev3q"></p>
<p>RPMSG 协议</p>
<p>既然 RPMsg 是一种信息交换的协议，与TCP/IP类似，RPMsg 协议也有分层，主要分为三层，分别是传输层、MAC层和物理层。</p>
<p><img decoding="async" loading="lazy" alt="image-20220704161948895" src="/assets/images/image-20220704161948895-f6b3d96fccdf2e952423544492bacd76.png" width="411" height="215" class="img_ev3q"></p>
<p>其中 MAC层 的 VirtIO 是一种I/O 半虚拟化解决方案，是一套通用 I/O 设备虚拟化的程序，是对半虚拟化 Hypervisor 中的一组通用 I/O 设备的抽象。 提供了一套上层应用与各 Hypervisor 虚拟化设备之间的通信框架和编程接口，减少跨平台所带来的兼容性问题，大大提高驱动程序开发效率。</p>
<p>RPMsg 总线上的消息都具有以下结构，包含消息头和数据两个固定的部分，该消息格式的定义位于<code>drivers/rpmsg/virtio_rpmsg_bus.c</code>中，具体定义如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">rpmsg_hdr</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u32 src</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u32 dst</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u32 reserved</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u16 len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u16 flags</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u8 data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> __packed</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="异构系统控制">异构系统控制<a href="#异构系统控制" class="hash-link" aria-label="异构系统控制的直接链接" title="异构系统控制的直接链接" translate="no">​</a></h2>
<p>在异构系统中，不止需要消息的传输，还需要相关控制。例如主核对辅助核心的开启，加载固件，关闭等等。这就需要用到 remoteproc 框架。</p>
<p>remoteproc 框架支持对不同平台，不同架构的处理器进行控制，可以监控辅助核心的运行情况。</p>
<p>对于 T113 来说，remoteproc 用于对 C906 进行生命周期管理，一般来说包含有加载固件、 检测远端处理器是否崩溃等功能。它在加载远端处理器的固件时，会根据固件中定义的 resource table 来申请资源，并创建 VirtIO 设备。</p>
<p><code>remoteproc</code> 框架抽象出硬件差异，允许不同的平台/架构来控制（开机、加载固件、关机）这些远程处理器，此外，还为支持这种通信的远程处理器添加了 <code>rpmsg</code> <code>virtio</code> 设备。这样，特定平台的 <code>remoteproc</code> 驱动程序只需要提供一些低级处理程序，然后所有 <code>rpmsg</code> 驱动程序就可以正常工作。</p>
<p>作用：</p>
<ul>
<li>从文件系统加载固件</li>
<li>准备远程处理器所需资源</li>
<li>注册一个 <code>rpmsg virtio</code> 设备</li>
<li>提供对要提供对远程处理器的生命周期进行管理</li>
</ul>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2022-07-19-15-33-28-image-d25abb3ac23e3ae502ae7516a6b15c63.png" width="817" height="500" class="img_ev3q"></p>
<p>所以固件的加载流程大致如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 加载固件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. 调用 firmware 接口获取文件系统中的固件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2. 解析固件的 resource_table 段，该段有如下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1. 声明需要的内存（Linux 为其分配）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      2. 声明使用的 vdev（固定为一个）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      3. 声明使用的 vring（固定为两个）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3. 将固件加载到指定地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 注册 rpmsg virtio 设备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. 提供 vdev-&gt;ops（基于 virtio 接口实现的）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2. 与 rpmsg_bus 驱动匹配，完成 rpmsg 初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 启动小核</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. 调用 rproc-&gt;ops-&gt;start</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux内核配置">Linux内核配置<a href="#linux内核配置" class="hash-link" aria-label="Linux内核配置的直接链接" title="Linux内核配置的直接链接" translate="no">​</a></h2>
<p>首先需要配置设备树，预留 C906 核心内存，<code>buffer</code> 内存，<code>vring</code> 内存等。并正确配置 <code>rproc</code> 与 <code>rpbuf</code>，也不要忘记配置 <code>firmware-name</code>，下面的配置是T113默认提供的示例 为测试固件所使用的地址。不同的固件地址可能不同。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reserved-memory {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		#address-cells = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		#size-cells = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		ranges;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* c906 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		c906_ddr: c906_ddr@42300000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42300000 0x0 0x00600000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The name should be &quot;vdev%dbuffer&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * Its size should be not less than</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *     RPMSG_BUF_SIZE * (num of buffers in a vring) * 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *   = 512 * (num of buffers in a vring) * 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rv_vdev0buffer: vdev0buffer@42900000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			compatible = &quot;shared-dma-pool&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42900000 0x0 0x40000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The name should be &quot;vdev%dvring%d&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The size of each should be not less than</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *     PAGE_ALIGN(vring_size(num, align))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *   = PAGE_ALIGN(16 * num + 6 + 2 * num + (pads for align) + 6 + 8 * num)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * (Please refer to the vring layout in include/uapi/linux/virtio_ring.h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rv_vdev0vring0: vdev0vring0@42940000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42940000 0x0 0x2000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rv_vdev0vring1: vdev0vring1@42942000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42942000 0x0 0x2000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/* dsp0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dsp0ddr: dsp0ddr@42000000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42000000 0x0 0x00100000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dsp0_rpbuf_reserved: dsp0_rpbuf@42244000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			compatible = &quot;shared-dma-pool&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42244000 0x0 0x8000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The name should be &quot;vdev%dbuffer&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * Its size should be not less than</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *     RPMSG_BUF_SIZE * (num of buffers in a vring) * 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *   = 512 * (num of buffers in a vring) * 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		vdev0buffer: vdev0buffer@42200000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			compatible = &quot;shared-dma-pool&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42200000 0x0 0x40000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The name should be &quot;vdev%dvring%d&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * The size of each should be not less than</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *     PAGE_ALIGN(vring_size(num, align))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *   = PAGE_ALIGN(16 * num + 6 + 2 * num + (pads for align) + 6 + 8 * num)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 * (Please refer to the vring layout in include/uapi/linux/virtio_ring.h)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		vdev0vring0: vdev0vring0@42240000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42240000 0x0 0x2000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		vdev0vring1: vdev0vring1@42242000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x42242000 0x0 0x2000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		* dsp ram addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dsp0dram: dsp0dram@400000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x400000 0x0 0x10000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dsp0iram0: dsp0iram0@420000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x420000 0x0 0x8000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		dsp0iram1: dsp0iram1@440000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			reg = &lt;0x0 0x440000 0x0 0x8000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			no-map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	mailbox_heartbeat: mailbox_heartbeat@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		compatible = &quot;mailbox-heartbeat&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rproc-np = &lt;&amp;c906_rproc&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mboxes = &lt;&amp;msgbox 6&gt;, &lt;&amp;msgbox 7&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mbox-names = &quot;tx&quot;, &quot;rx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	dsp0_rproc: dsp_rproc@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		compatible = &quot;allwinner,hifi4-rproc&quot;, &quot;simple-bus&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clock-frequency = &lt;600000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clocks = &lt;&amp;ccu CLK_PLL_PERIPH0_2X&gt;, &lt;&amp;ccu CLK_DSP&gt;, &lt;&amp;ccu CLK_BUS_DSP_CFG&gt;, &lt;&amp;r_ccu CLK_R_AHB&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clock-names = &quot;pll&quot;, &quot;mod&quot;, &quot;cfg&quot;, &quot;ahbs&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		resets = &lt;&amp;ccu RST_BUS_DSP&gt;, &lt;&amp;ccu RST_BUS_DSP_CFG&gt;, &lt;&amp;ccu RST_BUS_DSP_DBG&gt;, &lt;&amp;ccu RST_BUS_MSGBOX1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reset-names = &quot;mod-rst&quot;, &quot;cfg-rst&quot;, &quot;dbg-rst&quot;, &quot;msg-rst&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reg = &lt;0x0 0x03000008 0x0 0x04&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		      &lt;0x0 0x01700000 0x0 0x40&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reg-names = &quot;sram-for-cpux&quot;, &quot;hifi4-cfg&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mboxes = &lt;&amp;msgbox 0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mbox-names = &quot;arm-kick&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		memory-region = &lt;&amp;dsp0ddr&gt;, &lt;&amp;vdev0buffer&gt;, &lt;&amp;vdev0vring0&gt;, &lt;&amp;vdev0vring1&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">				&lt;&amp;dsp0dram&gt;, &lt;&amp;dsp0iram0&gt;, &lt;&amp;dsp0iram1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		memory-mappings =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* &lt; DA		len		PA &gt;	*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* local SRAM via external bus */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x28000	0x20000		0x28000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* local SRAM via internal bus */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x400000	0x10000		0x400000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x420000	0x8000		0x420000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x440000	0x8000		0x440000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR front 256MB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x10000000	0x10000000	0x40000000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* local SRAM via internal bus */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x20028000	0x10000		0x400000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x20038000	0x8000		0x420000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x20040000	0x8000		0x440000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR front 256MB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x30000000	0x10000000	0x40000000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR front 1GB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x40000000	0x40000000	0x40000000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR front 1GB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x80000000	0x40000000	0x40000000 &gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR front 1GB */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0xC0000000	0x40000000	0x40000000 &gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		id = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rpbuf_controller0: rpbuf_controller@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		compatible = &quot;allwinner,rpbuf-controller&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		remoteproc = &lt;&amp;dsp0_rproc&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		ctrl_id = &lt;0&gt;;	/* index of /dev/rpbuf_ctrl */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		//iommus = &lt;&amp;mmu_aw 5 1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		memory-region = &lt;&amp;dsp0_rpbuf_reserved&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	rpbuf_sample: rpbuf_sample@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		compatible = &quot;allwinner,rpbuf-sample&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		rpbuf = &lt;&amp;rpbuf_controller0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	c906_rproc: c906_rproc@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		compatible = &quot;allwinner,c906-rproc&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clock-frequency = &lt;800000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clocks = &lt;&amp;ccu CLK_PLL_PERIPH0_800M&gt;, &lt;&amp;ccu CLK_RISCV&gt;, &lt;&amp;ccu CLK_BUS_RISCV_CFG&gt;, &lt;&amp;ccu CLK_RISCV_RST&gt;, &lt;&amp;ccu CLK_BUS_RISCV&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		clock-names = &quot;pll&quot;, &quot;mod&quot;, &quot;cfg&quot;, &quot;riscv-rst&quot;, &quot;riscv-gate&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		resets = &lt;&amp;ccu RST_BUS_RISCV_CFG&gt;, &lt;&amp;ccu RST_BUS_MSGBOX2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reset-names = &quot;cfg-rst&quot;, &quot;msg-rst&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		memory-region = &lt;&amp;c906_ddr&gt;, &lt;&amp;rv_vdev0buffer&gt;, &lt;&amp;rv_vdev0vring0&gt;, &lt;&amp;rv_vdev0vring1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reg = &lt;0x0 0x06010000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		reg-names = &quot;c906-cfg&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mboxes = &lt;&amp;msgbox 4&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		mbox-names = &quot;arm-kick&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		memory-mappings =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DA 	         len         PA */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			/* DDR for c906  */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			&lt; 0x40000000 0x10000000 0x40000000 &gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		firmware-name = &quot;amp_rv0.bin&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	};</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置内核驱动">配置内核驱动<a href="#配置内核驱动" class="hash-link" aria-label="配置内核驱动的直接链接" title="配置内核驱动的直接链接" translate="no">​</a></h3>
<p>接下来需要配置 <code>kernel</code> 选项，配置驱动。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">build</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sh menuconfig</span><br></span></code></pre></div></div>
<p>并勾选以下驱动：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Device Drivers </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Mailbox Hardware Support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> Mailbox Hardware Support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Platform MHU Mailbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Altera Mailbox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Mailbox Test Client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Mailbox Heartbeat driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Allwinner mailbox support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">     Allwinner mailbox support txdone irq</span><br></span></code></pre></div></div>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Device Drivers </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Remoteproc drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Support </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> Remote Processor subsystem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Allwinner remoteproc support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Allwinner remoteproc hifi4 boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">   Allwinner remoteproc c906 boot</span><br></span></code></pre></div></div>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Device Drivers </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Rpmsg drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> RPMSG device interface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Qualcomm RPM Glink driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> sunxi amp msgbox driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> support send dsp standby msg when suspend</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Virtio RPMSG bus driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Allwinner rpmsg notify driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Allwinnertech RPMSG hearbeat driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Allwinner RPMsg tty driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Allwinner RPMsg client sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sunxi rpmsg ctrl driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Allwinner rpmsg openamp test driver</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载小核固件">加载小核固件<a href="#加载小核固件" class="hash-link" aria-label="加载小核固件的直接链接" title="加载小核固件的直接链接" translate="no">​</a></h3>
<p>测试固件下载地址： <a href="https://github.com/DongshanPI/T113M4-DevKit_TinaSDK5" target="_blank" rel="noopener noreferrer">https://github.com/DongshanPI/T113M4-DevKit_TinaSDK5</a></p>
<p>烧录启动系统后，可以在 <code>/sys/kernel/debug/remoteproc/</code> 节点找到 <code>remoteproc1</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240909160554949" src="/assets/images/image-20240909160554949-5c3b932cb0929739e5df7333ae140199.png" width="1288" height="145" class="img_ev3q"></p>
<p>我们可以使用 <code>cat</code> 命令检查小核目前的状况</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">debug</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">state</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240909160830827" src="/assets/images/image-20240909160830827-be38abcb64e4d2b546f14c01d9f94661.png" width="2291" height="285" class="img_ev3q"></p>
<p>可以看到提示没有 state 这个节点信息，那么应该是没有默认加载 c906 小核固件。此时我们需要把准备好的固件放置到开发板的 <code>lib/firmware</code> 文件夹内。这里我们使用 <code>adb</code> 上传小核固件。</p>
<p>然后我们将 c906 固件置于 <code>firmware</code> 节点内，并启动固件。</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo amp_rv0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bin </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">firmware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo start </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">state</span><br></span></code></pre></div></div>
<p>此时可以看到 <code>remoteproc remoteproc1: remote processor c906_rproc is now up</code>，同时查看状态也显示了 <code>running</code></p>
<p><img decoding="async" loading="lazy" alt="image-20240909161015908" src="/assets/images/image-20240909161015908-3cae88fb060742dbe2eecbc2050113c6.png" width="2582" height="586" class="img_ev3q"></p>
<p>此时也可以用 <code>stop</code> 命令停止小核运行</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo stop </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">remoteproc1</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">state</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240909161103533" src="/assets/images/image-20240909161103533-a8abfb61bed53f5a3fb89e2e3173a8e0.png" width="2969" height="204" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="amp-shell测试小核">AMP SHELL测试小核<a href="#amp-shell测试小核" class="hash-link" aria-label="AMP SHELL测试小核的直接链接" title="AMP SHELL测试小核的直接链接" translate="no">​</a></h3>
<p>Linux端提供了进入从核控制台的功能也就是AMP SHELL，可以直接在Linux终端中，通过 amp_shell 命令进入 C906 异构核心。</p>
<p>首先确保C906 小核已经正常启动，之后使用如下命令进入小核 shell 终端。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@TinaLinux:~# amp_shell  -d /dev/rpmsg_ctrl-c906_rproc@0</span><br></span></code></pre></div></div>
<p>便可以启动小核的固件</p>
<p><img decoding="async" loading="lazy" alt="image-20240910172921007" src="/assets/images/image-20240910172921007-8f6c439a970cd56716caa07aec9b57c3.png" width="2283" height="745" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rtos系统介绍">RTOS系统介绍<a href="#rtos系统介绍" class="hash-link" aria-label="RTOS系统介绍的直接链接" title="RTOS系统介绍的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="系统架构">系统架构<a href="#系统架构" class="hash-link" aria-label="系统架构的直接链接" title="系统架构的直接链接" translate="no">​</a></h3>
<p>RTOS 系统是基于FreeRTOS 内核的软件开发包，包含了系统开发用到的内核源码、驱动、工具、组件与应用程序包。通过Makefile 脚本和Kconfig 配置文件，使得用户可以通过menuconfig 进行个性化裁减，编译出一个可以直接烧写到机器上运行的RTOS 系统软件。</p>
<p><img decoding="async" loading="lazy" alt="image-20240909152743452" src="/assets/images/image-20240909152743452-e4f5ba150cfcf9f0b0636c82ce2d6972.png" width="2448" height="850" class="img_ev3q"></p>
<p>RTOS 系统框图如上图，仅从软件的角度来看，从下至上分为内核层、组件层、应用层三个层次。各层次主要内容如下：</p>
<ul>
<li>Kernel：内核层包括FreeRTOS 核心系统、文件系统、网络系统、BSP 驱动等。</li>
<li>Component：组件层包括控制台、多媒体、功耗管理、OTA、音频系统、显示系统、图像采集等。</li>
<li>APP：应用层包括各种应用demo。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="目录结构">目录结构<a href="#目录结构" class="hash-link" aria-label="目录结构的直接链接" title="目录结构的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rtos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── board # 包含各SoC板级配置目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── t113_s3p_c906 # t113_s3p_c906板级配置目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── t113_s4_c906 # t113_s4_c906板级配置目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── t113_s4p_c906 # t113_s4p_c906板级配置目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── XXX # XXX平台板级配置目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── envsetup.sh # SDK环境初始化脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lichee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── dsp # DSP FreeRTOS系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── rtos # ARM/RISC‑V架构的FreeRTOS系统</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── rtos‑components # FreeRTOS公共组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── rtos‑hal # BSP驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tools # 打包相关工具脚本目录</span><br></span></code></pre></div></div>
<p>所使用RTOS SDK 目录结构如上所示，主要包括如下几个关键目录：</p>
<ul>
<li>board：板级配置目录，用于存放芯片方案的配置文件，主要包括系统配置文件sys_config.fex等。</li>
<li>lichee/dsp：存 放DSP FreeRTOS 系统、组件、应用。</li>
<li>lichee/rtos：存放ARM/RISC‑V 架构FreeRTOS 系统、组件、应用。</li>
<li>lichee/rtos‑components：公共组件目录，lichee/dsp 与lichee/rtos 都可以使用该组件。</li>
<li>lichee/rtos‑hal：BSP 驱动目录，用于存放各种驱动代码。对lichee/dsp 与lichee/rtos 通用。</li>
<li>tools：工具目录，用于存放编译打包相关的脚本、工具等。</li>
<li>下面对lichee/rtos、lichee/rtos‑hal 目录进行详细说明。lichee/dsp 目录与lichee/rtos 目录类似，此处不做介绍。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="licheertos-目录">lichee/rtos 目录<a href="#licheertos-目录" class="hash-link" aria-label="lichee/rtos 目录的直接链接" title="lichee/rtos 目录的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── arch # 处理器架构相关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── build # 编译临时文件输出目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── components # 组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── drivers # 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── include # 头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── kernel # FreeRTOS 内核</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── projects # 方案工程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tools # 工具链</span><br></span></code></pre></div></div>
<p>lichee/rtos 目录主要包括arch（架构相关）、components（组件）、drivers（驱动）、include （头文件）、kernel（内核）、projects（工程）、toos(工具链) 等目录，下面对常用重要目录分别进行介绍。</p>
<ul>
<li>arch 目录
arch 目录主要放置跟SoC 架构相关的内容，每个SoC 单独目录管理，主要包括跟risc‑v 架构相关的ARCH 初始化、中断处理、异常处理、内存映射相关功能的实现。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  lichee/rtos/arch/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── risc‑v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── arch.mk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── c906</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── e906</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── includes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Kconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── sun55iw3p1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── sun8iw20p1</span><br></span></code></pre></div></div>
<ul>
<li>components 目录
components 目录包含allwinner 和第三方的组件。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos/components/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── blkpart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── bluetooth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── csi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── devfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── healthd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── watchpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── wireless_video</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── common ‑&gt; ../../rtos‑components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── thirdparty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── cplusplus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── elmfat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── finsh_cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vfs</span><br></span></code></pre></div></div>
<ul>
<li>drivers 目录
drivers 目录包含所需的外设驱动，主要包括各外设控制器驱动的具体实现（hal 软连接）以及OSAL 层接口（osal）。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos/drivers/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── drv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── cpufreq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── leds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── uart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── wireless</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── hal ‑&gt; ../../rtos‑hal/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── osal</span><br></span></code></pre></div></div>
<ul>
<li>include 目录
include 目录统一管理各模块提供的数据结构定义及函数声明</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos/include/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── arch # 架构相关头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── FreeRTOS_POSIX # POSIX头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vsprintf.h</span><br></span></code></pre></div></div>
<ul>
<li>kernel 目录
kernel 目录主要包含FreeRTOS 的kernel 源码，全志实现的系统功能相关代码。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos/kernel/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── FreeRTOS‑orig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── Posix</span><br></span></code></pre></div></div>
<ul>
<li>projects 目录
projects 目录下的每一个子目录代表一个project，实现main 入口，选择不同的project 编译出
来的bin 具有不同功能，每个project 有独立的FreeRTOSConfig 配置。例如T113，其对应于
t113_c906 子目录。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos/projects/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Kconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── t113_c906</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── evb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── freertos.lds.S</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── main.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ └── FreeRTOSConfig.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── Makefile</span><br></span></code></pre></div></div>
<ul>
<li>tools 目录<!-- -->
<ul>
<li>risc‑v 架构这个目录主要包含一些预编译好的交叉编译工具链，目前risc‑v 基于GCC 8.4.0 的交叉编译器。</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xxx@xxx:lichee/rtos/tools$ ./riscv64‑elf‑x86_64‑20201104/bin/riscv64‑unknown‑elf‑gcc ‑‑version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">riscv64‑unknown‑elf‑gcc (T‑HEAD RISCV Tools V1.10.2 B20201104) 8.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright (C) 2018 Free Software Foundation, Inc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is free software; see the source for copying conditions. There is NO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="licheertoshal-目录">lichee/rtos‑hal 目录<a href="#licheertoshal-目录" class="hash-link" aria-label="lichee/rtos‑hal 目录的直接链接" title="lichee/rtos‑hal 目录的直接链接" translate="no">​</a></h4>
<blockquote>
<p>lichee/rtos‑hal 目录为BSP 驱动目录，用于存放各种驱动代码。</p>
</blockquote>
<p>lichee/rtos/drivers 目录下的rtos‑hal 子目录软链接到该目录，下面对该目录进行介绍。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos‑hal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── hal # BSP驱动代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── include # 驱动相关头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tools</span><br></span></code></pre></div></div>
<p>lichee/rtos‑hal 目录主要包括hal（BSP 驱动代码）、include（驱动相关头文件）等目录，下面分别对其进行介绍。</p>
<ul>
<li>hal 目录
hal 目录主要包含各外设驱动代码以及驱动测试代码，source 子目录为驱动代码，test 子目录为驱动测试代码。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lichee/rtos‑hal/hal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── ccmu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── gpio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── uart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ └── watchdog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ccmu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── gpio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── uart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── watchdog</span><br></span></code></pre></div></div>
<ul>
<li>include 目录
include 目录主要包含驱动相关头文件以及系统相关接口头文件。</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  lichee/rtos‑hal/include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── hal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── aw‑alsa‑lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── aw_common.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── sunxi_hal_usb.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ ├── sunxi_hal_watchdog.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │ └── video</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── osal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── hal_atomic.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── hal_cache.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── hal_waitqueue.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── hal_workqueue.h</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rtos开发说明">RTOS开发说明<a href="#rtos开发说明" class="hash-link" aria-label="RTOS开发说明的直接链接" title="RTOS开发说明的直接链接" translate="no">​</a></h2>
<p>RTOS 环境已集成到Tina Linux 开发环境，通过全志代码服务器对外发布。Tina Linux 开发环境下的rtos 子目录即为RTOS 环境。</p>
<p>Tina 集成了RTOS 的编译、打包功能，而且适用于openwrt、buildroot 等文件系统。这里以T113‑S4 作为例子进行阐述。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="关联rtos方案">关联RTOS方案<a href="#关联rtos方案" class="hash-link" aria-label="关联RTOS方案的直接链接" title="关联RTOS方案的直接链接" translate="no">​</a></h3>
<p>在BoardConfig.mk 文件配置RTOS 方案名，关键字段为LICHEE_RTOS_PROJECT_NAME:=xxxxx。目前使用<strong>t113_s4_c906_evb1_auto</strong>的RTOS 方案。</p>
<p>开发者可以通过修改LICHEE_RTOS_PROJECT_NAME 字段，更改构建RTOS 方案。进入Tina 的rtos 目录(目录结构如下)，可以查看到支持RTOS 方案。</p>
<p><img decoding="async" loading="lazy" alt="image-20240910183758461" src="/assets/images/image-20240910183758461-cb9152c5b29fc1300a3ec4135d07a6cd.png" width="2024" height="972" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── board</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── envsetup.sh ‑&gt; tools/scripts/source_envsetup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lichee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tools</span><br></span></code></pre></div></div>
<p>执行以下命令
<code>source envsetup.sh</code> # 配置环境变量
<code>lunch_rtos</code> # 选择编译方案
我们看到可以选择RTOS 方案，即是LICHEE_RTOS_PROJECT_NAME 字段可以配置的RTOS 方案。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. t113_i_c906_evb1_auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. t113_s3p_c906_evb1_auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. t113_s3p_c906_evb1_auto_fastboot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. t113_s3p_c906_evb1_auto_fastboot_video</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5. t113_s3p_c906_evb1_auto_non_os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6. t113_s3p_c906_example_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7. t113_s4_c906_evb1_auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8. t113_s4_c906_evb1_auto_fastboot_video</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9. t113_s4p_c906_evb1_auto</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image-20240910184123073" src="/assets/images/image-20240910184123073-c65cd781af2cfa6a5ca7d3288d56840b.png" width="3228" height="1423" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编译rtos方案">编译RTOS方案<a href="#编译rtos方案" class="hash-link" aria-label="编译RTOS方案的直接链接" title="编译RTOS方案的直接链接" translate="no">​</a></h3>
<p>重新打开一个终端，避免环境变量冲突，在Tina SDK 根目录中，先选择好整体平台方案。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="buildroot-方案">buildroot 方案<a href="#buildroot-方案" class="hash-link" aria-label="buildroot 方案的直接链接" title="buildroot 方案的直接链接" translate="no">​</a></h4>
<p>1、首先使用如下命令选择整体平台方案
<code>./build.sh config</code>
2、然后RTOS 相关操作命令如下
<code>./build.sh rtos</code> #单独编译RTOS方案
<code>./build.sh rtos menuconfig</code> #修改RTOS配置文件
<code>./build.sh rtos clean</code> #清除RTOS编译中间文件</p>
<p>说明: 执行./build.sh 不会编译RTOS</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="openwrt-方案">openwrt 方案<a href="#openwrt-方案" class="hash-link" aria-label="openwrt 方案的直接链接" title="openwrt 方案的直接链接" translate="no">​</a></h4>
<p>1、首先使用如下命令选择整体平台方案
<code>source build/envsetup.sh</code> #生效环境变量
<code>lunch</code> #选择openwrt方案
2、执行<code>make</code> 会先编译RTOS，再编译Tina</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="编译快捷命令">编译快捷命令<a href="#编译快捷命令" class="hash-link" aria-label="编译快捷命令的直接链接" title="编译快捷命令的直接链接" translate="no">​</a></h3>
<p>在Tina 根目录下，执行了source build/envsetup.sh 后，可以使用RTOS 快捷命令</p>
<table><thead><tr><th>命令</th><th>命令有效目录</th><th>作用</th></tr></thead><tbody><tr><td>mrtos</td><td>Tina 环境下任意目录</td><td>单独编译RTOS 方案</td></tr><tr><td>mrtos menuconfig</td><td>Tina 环境下任意目录</td><td>修改RTOS 配置文件</td></tr><tr><td>mrtos clean</td><td>Tina 环境下任意目录</td><td>清除RTOS 编译中间文件</td></tr><tr><td>crtos</td><td>Tina 环境下任意目录</td><td>进入RTOS 源码目录</td></tr><tr><td>crtos‑hal</td><td>Tina 环境下任意目录</td><td>进入RTOS‑HAL 源码目录</td></tr></tbody></table>
<p>然后将Tina 环境重新编译和打包，确保RTOS 编译固件amp_rv0.bin 打包到根文件系统中。</p>
<p>说明 buildroot 需要执行<code>./build.sh &amp;&amp; ./build.sh pack</code> 命令
说明 openwrt 需要执行<code>make &amp;&amp; pack </code>命令</p>
<p>打包完成后，生产的固件位于tina5.0/out/t113_s4_linux_evb1_auto_uart0.img，可以使用PhoenixSuit 工具烧录到开发板上。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rtos-固件打包">RTOS 固件打包<a href="#rtos-固件打包" class="hash-link" aria-label="RTOS 固件打包的直接链接" title="RTOS 固件打包的直接链接" translate="no">​</a></h3>
<p>编译完成后， 生成的镜像文件会自动拷贝到对应平台方案中， 并且rt_system.elf 重名为 amp_rv0.bin 。</p>
<p><img decoding="async" loading="lazy" alt="image-20240910184339126" src="/assets/images/image-20240910184339126-29d0ae7d8aeee730da580eb2573c5494.png" width="3772" height="1726" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Allwinner tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/allwinner">Allwinner</a></li><li class="tag_QGVx"><a rel="tag" title="T113 tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/t113">T113x</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/welcome">Welcome</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-11-06T00:00:00.000Z">2025年11月6日</time> · <!-- -->阅读需 0 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/yuxuan"><img class="avatar__photo authorImage_XqGP" src="https://dshanpi.100ask.org/img/logo.svg" alt="世玉轩"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/yuxuan"><span class="authorName_yefp" translate="no">世玉轩</span></a></div><small class="authorTitle_nd0D" title="100askTeam yuxuan.">100askTeam yuxuan.</small><div class="authorSocials_rSDt"><a href="https://x.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="X"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 1200 1227" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"></path></svg></a><a href="https://github.com/codebug8" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/all-sebastien-lorber-articles"><img class="avatar__photo authorImage_XqGP" src="https://dshanpi.100ask.org/img/logo.svg" alt="韦东山"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/all-sebastien-lorber-articles"><span class="authorName_yefp" translate="no">韦东山</span></a></div><small class="authorTitle_nd0D" title="100askTeam maintainer">100askTeam maintainer</small><div class="authorSocials_rSDt"><a href="https://github.com/weidongshan" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div class="markdown"></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Allwinner tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/allwinner">Allwinner</a></li><li class="tag_QGVx"><a rel="tag" title="T113 tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/t113">T113x</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>